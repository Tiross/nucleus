
language: node_js

node_js:
  - lts/*
  - node
  - 10
  - 9
  - 8
  - 7
  - 6

cache:
  directories:
    - node_modules

stages:
  - lint
  - test
  - build
  - deploy

jobs:
  include:
    - stage: lint
      script: npm run lint

    - stage: build
      name: Build assets
      skip_cleanup: true
      before_script:
        - npm run build
        - npm run build_docs
      script: deploy/develop.sh
      node_js: node
      on:
        branch:
          - develop
          - release/*
        type: push

    - stage: deploy
      name: npm release
      node_js: node
      script: echo "Deploying to npm ..."
      deploy:
        provider: npm
        email: $NPM_EMAIL
        api_key: $NPM_API_KEY
        on:
          tags: true

    - stage: deploy
      name: GitHub pages
      skip_cleanup: true
      before_script:
        - npm run build
        - npm run build_docs
        - node index.js --config demo.nucleus.json
      script: deploy/gh-pages.sh
      node_js: node
      on:
        branch: master
        type: push
